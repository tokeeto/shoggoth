#:kivy 2.0.0
#:import os os
#:import ui ui
#:import Factory kivy.factory.Factory

<TextInput>
    write_tab: False

<DropDownButton@Button>:
    size_hint_y: None
    height: 30

<ClassSelectDropdown@DropDown>:
    DropDownButton:
        text: 'guardian'
        on_release: root.select_value(self.text)
    DropDownButton:
        text: 'seeker'
        on_release: root.select_value(self.text)
    DropDownButton:
        text: 'rogue'
        on_release: root.select_value(self.text)
    DropDownButton:
        text: 'survivor'
        on_release: root.select_value(self.text)
    DropDownButton:
        text: 'mystic'
        on_release: root.select_value(self.text)

<FileChooserPopup>:
    filechooser: filechooser
    title: 'Select file'
    size_hint: .7, .7
    BoxLayout:
        size: root.size
        pos: root.pos
        orientation: "vertical"
        FileChooserListView:
            id: filechooser

        BoxLayout:
            size_hint_y: None
            height: 30
            Button:
                text: "Cancel"
                on_release: root.dismiss()

            Button:
                text: "Load"
                on_release: root.select(filechooser.path, filechooser.selection[0])

<FileSavePopup>:
    title: 'Save file'
    text_input: text_input
    BoxLayout:
        size: root.size
        pos: root.pos
        orientation: "vertical"
        FileChooserListView:
            id: filechooser
            on_selection: text_input.text = self.selection[0] or ''

        TextInput:
            id: text_input
            size_hint_y: None
            height: 30
            multiline: False

        BoxLayout:
            size_hint_y: None
            height: 30
            Button:
                text: "Cancel"
                on_release: root.dismiss()
            Button:
                text: "Save"
                on_release: root.select(filechooser.path, text_input.text)

<CardPreview>:
    padding: '10dp'
    TabbedPanel:
        background_color: 0,0,0,0
        do_default_tab: False

        TabbedPanelItem:
            text: 'Front'
            Image:
                id: front_preview

        TabbedPanelItem:
            text: 'Back'
            Image:
                id: back_preview


<NewProjectPopup@Popup>:
    title: 'New Project'
    size_hint: 0.75, 0.75
    file_name: file_name

    BoxLayout:
        orientation: 'vertical'

        BoxLayout:
            orientation: "horizontal"
            size_hint_y: None
            height: '32dp'

            Label:
                size_hint_x: 0.2
                text: 'abbreviation'
            TextInput:
                size_hint_x: 0.8
                id: code
                value: 'xxx'

        BoxLayout:
            orientation: "horizontal"
            size_hint_y: None
            height: '32dp'
            Label:
                size_hint_x: 0.2
                text: 'name'
            TextInput:
                size_hint_x: 0.8
                id: name
                value: ''

        BoxLayout:
            orientation: "horizontal"
            size_hint_y: None
            height: '32dp'
            Label:
                size_hint_x: 0.2
                text: 'Icon'
            TextInput:
                size_hint_x: 0.6
                id: icon
                value: ''
                disabled: True
            Button:
                size_hint_x: 0.2
                text: 'Select icon'
                on_release: ui.show_file_select(icon)

        BoxLayout:
            orientation: "horizontal"
            size_hint_y: None
            height: '32dp'
            Label:
                size_hint_x: 0.2
                text: 'File name'
            TextInput:
                size_hint_x: 0.6
                id: file_name
                size_hint_y: None
                height: 30
                disabled: True
            Button:
                size_hint_x: 0.2
                text: 'Save location'
                on_release: ui.show_file_save(file_name)

        BoxLayout:
            size_hint_y: None
            height: '48dp'

            Button:
                text: 'Cancel'
                on_release: root.dismiss()

            Button:
                text: 'Select'
                on_release: root.save()


<TreeViewLabel>:
    full_path: ''
    color: 0.3, 0.3, 0.3, 1
    font_size: '14sp'

<TreeViewButton>
    on_release: root.select()
    background_color: 0,0,0,0
    color_selected: 0,0,0,.3

<ShogothRoot>:
    orientation: 'vertical'
    canvas:
        Rectangle:
            #source: 'assets/wooden-floor-background.jpg'
            #source: 'assets/stars2.png'
            source: 'assets/parchment2.png'
            #source: 'assets/dark_paper_background.jpg'
            size: self.size
            pos: self.pos

    BoxLayout:
        size_hint_y: None
        height: '48dp'
        padding: '5dp'
        spacing: '5dp'

        Button:
            text: 'Open Project'
            size_hint_x: None
            width: '120dp'
            on_release: app.open_project_dialog()

        Button:
            text: 'New Project'
            size_hint_x: None
            width: '120dp'
            on_release: app.new_project_dialog()

        Button:
            text: 'Save all'
            size_hint_x: None
            width: '120dp'
            on_release: app.save_changes()

        Label:
            text: 'Project: ' + (os.path.basename(app.project_path) if app.project_path else 'None')
            size_hint_x: 1
            halign: 'left'
            valign: 'middle'
            text_size: self.size

    BoxLayout:
        orientation: 'horizontal'

        # File Browser Panel (left)
        Splitter:
            sizable_from: 'right'
            size_hint_x: None
            width: 350

            FileBrowser:
                id: file_browser

        # Editor Panel (middle)
        BoxLayout:
            id: editor_container

        # Card Preview Panel (right)
        Splitter:
            sizable_from: 'left'
            size_hint_x: None
            min_size: 400

            CardPreview:
                id: card_preview

    # Status bar
    Label:
        id: status_bar
        text: app.status_message
        size_hint_y: None
        height: '24dp'
        text_size: self.size
        halign: 'left'
        padding: '10dp', 0
        canvas.before:
            Color:
                rgba: 0,0,0,.3
            Rectangle:
                size: self.size
                pos: self.pos

<FileBrowser>:
    tree: tree
    orientation: 'vertical'
    canvas:
        Color:
            rgba: 1,1,1,.4
        Rectangle:
            source: None
            size: self.size
            pos: self.pos
        Color:
            rgba: 1,1,1,1


    Label:
        text: 'Files'
        size_hint_y: None
        height: '30dp'
        font_size: '16sp'
        bold: True

    ScrollView:
        do_scroll_x: False

        TreeView:
            id: tree
            hide_root: True
            size_hint_y: None
            height: self.minimum_height

<FileField@BoxLayout>:
    orientation: 'horizontal'
    text: ''
    path: ''
    size_hint_y: None
    height: 30

    Label:
        size_hint_x: None
        width: 100
        text: root.text
    TextInput:
        text: root.path
    Button:
        size_hint_x: None
        width: 40
        text: 'üìÅ'
        on_press: root.show_file_selector()

<NewEncounterPopup>:
    name: name
    error: error
    BoxLayout:
        orientation: 'vertical'
        Label:
            id: error
            text: ''
        TextInput:
            id: name
        Button:
            text: 'Create'
            on_release: root.create()

<NewCardPopup>:
    title: 'Name of card'
    name: name
    error: error
    size_hint: None, None
    width: 400
    height: 180
    BoxLayout:
        orientation: 'vertical'
        TextInput:
            id: name
        Label:
            size_hint_y: None
            height: 24 if self.text else 0
            color: 1,.1,.1
            id: error
            text: ''
        Button:
            text: 'Create'
            on_release: root.create()

<ProjectEditor>:
    orientation: 'vertical'
    TextEditLine:
        size_hint_y: None
        height: 28
        text: 'Name'
        field: root.project.get('name', '')
    FileField:
        size_hint_y: None
        height: 28
        text: 'Icon'
        path: root.project.get('icon', '')
    Button:
        size_hint_y: None
        height: 28
        text: 'Add Encounter set'
        on_release: root.show_new_encounter_popup()
    Button:
        size_hint_y: None
        height: 28
        text: 'Add Player Card'
        on_release: root.show_new_play_popup()
    Button:
        size_hint_y: None
        height: 28
        text: 'Delete'
        on_release: root.show_confirm_delete()
    ScrollView:
        size_hint: 1, 1
        GridLayout:
            size_hint_y: None
            height: self.minimum_height
            cols: 3
            id: thumbnail_grid

<EncounterEditor>:
    orientation: 'vertical'
    TextEditLine:
        text: 'Name'
        field: root.encounter.get('name', '')
    TextEditLine:
        text: 'Icon'
        field: root.encounter.get('icon', '')
    Button:
        text: 'Add new card'
        on_release: root.new_card()
    Button:
        text: 'Delete set'
    Button:
        text: 'Something else'

<CardEditor>:
    front_editor_container: front_editor_container
    back_editor_container: back_editor_container
    orientation: 'vertical'
    padding: '10dp'
    spacing: '5dp'

    TabbedPanel:
        do_default_tab: False
        background_color: 0,0,0,0
        TabbedPanelItem:
            text: 'Basic'
            ScrollView:
                BoxLayout:
                    orientation: 'vertical'

                    TextEditLine:
                        text: 'Name'
                        id: name
                    TextEditLine:
                        text: 'Amount in set'
                        id: amount
                    TextEditLine:
                        text: 'Collection Number'
                        id: collection_number


        TabbedPanelItem:
            text: 'Front'
            ScrollView:
                id: front_editor_container
        TabbedPanelItem:
            text: 'Back'
            ScrollView:
                id: back_editor_container

<TextEditLine@BoxLayout>:
    input: input
    text: ''
    orientation: 'horizontal'
    size_hint_y: None
    height: 30
    Label:
        size_hint_x: None
        width: 150
        text: root.text
    TextInput:
        id: input
        text: ''

<TextEditArea@BoxLayout>:
    orientation: 'horizontal'
    input: input
    text: ''
    size_hint_y: None
    height: 100
    Label:
        size_hint_x: None
        width: 200
        text: root.text
    TextInput:
        id: input
        text: ''
        multiline: True
        size_hint_y: None
        height: 100

<FaceEditor>:
    orientation: 'vertical'
    spacing: 2

    TextEditLine:
        text: 'Type'
        id: type

<-AssetEditor>:
    ScrollView:
        GridLayout:
            cols: 1
            size_hint_y: None
            height: self.minimum_height
            spacing: 5

            TextEditLine:
                text: 'type'
                id: type
            TextEditLine:
                text: 'name'
                id: name
            TextEditLine:
                text: 'subtitle'
                id: subtitle

            GridLayout:
                cols: 2
                size_hint_y: None
                height: self.minimum_height
                spacing: 5

                TextEditLine:
                    text: 'traits'
                    id: traits
                TextEditLine:
                    text: 'class'
                    id: card_class
                TextEditLine:
                    text: 'classes'
                    id: classes
                TextEditLine:
                    text: 'cost'
                    id: cost
                TextEditLine:
                    text: 'level'
                    id: level
                TextEditLine:
                    text: 'stamina'
                    id: stamina
                TextEditLine:
                    text: 'sanity'
                    id: sanity
            TextEditArea:
                text: 'text'
                id: text
            TextEditLine:
                text: 'flavor_text'
                id: flavor_text
            TextEditLine:
                text: 'illustration'
                id: illustration
            BoxLayout:
                orientation: "horizontal"
                TextEditLine:
                    text: 'illustration_pan_y'
                    id: illustration_pan_y
                TextEditLine:
                    text: 'illustration_pan_x'
                    id: illustration_pan_x
                TextEditLine:
                    text: 'illustration_scale'
                    id: illustration_scale
